<script src="https://cdnjs.cloudflare.com/ajax/libs/lite-youtube-embed/0.2.0/lite-yt-embed.js"></script>

{{ $post_class := $.Site.Params.post_class }}

 <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const postClass = '{{ or $post_class "post-content" }}';
      const processedVideos = new Set(); // Prevent duplicates

      // Select both post-content (detail pages) and e-content (homepage) elements
      const postContents = document.querySelectorAll(`.${postClass}, .e-content`);
      postContents.forEach(p => {
          const links = [...p.getElementsByTagName('a')]

          links.forEach(l => {
              if (!l.href) return

              // Check if link is a YouTube URL
              if (!(l.href.includes('youtube.com') || l.href.includes('youtu.be'))) return

              // https://gist.github.com/jphase/9086823
              const matches = l.href.match(/(http:|https:)?(\/\/)?(www\.)?(youtube.com|youtu.be)\/(watch|embed)?(\?v=|\/)?(\S+)?/)

              if (!matches || !matches[7]) return

              const ytId = matches[7]

              // Find the paragraph containing the link
              const paragraph = l.closest('p')
              if (!paragraph) return

              // Create unique key to prevent duplicate embeds
              const videoKey = `${ytId}-${paragraph.textContent.substring(0, 50)}`;

              if (processedVideos.has(videoKey)) return
              processedVideos.add(videoKey)

              const video = document.createElement('lite-youtube')
              video.setAttribute('videoid', ytId)
              video.setAttribute('playlabel', l.innerText || 'Play Video')

              // Insert video right after the paragraph
              paragraph.insertAdjacentElement('afterend', video)
          })
        })
    })
</script>